<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <h1>Hello World!</h1>
    <iframe
      id="target-iframe"
      src="https://scratch.mit.edu/projects/760487371/embed"
      allowtransparency="true"
      width="485"
      height="402"
      frameborder="0"
      scrolling="no"
      allowfullscreen
    ></iframe>
    <iframe
      id="target-iframe"
      src="test.html"
      width="485"
      height="402"
      frameborder="0"
      scrolling="no"
      allowfullscreen
    ></iframe>
    <p>分數為：<span id="score">0</span></p>
    <script>
      // 等待 iframe 加載完成
      const iframe = document.getElementById("target-iframe");

      iframe.addEventListener("load", () => {
        const iframeDocument =
          iframe.contentDocument || iframe.contentWindow.document;

        if (!iframeDocument) {
          console.error("無法訪問 iframe 的內容（可能是跨域問題）");
          return;
        }

        // 使用 MutationObserver 監聽 iframe 裡的 DOM 變化
        const observer = new MutationObserver((mutationsList) => {
          console.log(mutationsList); // 輸出 mutationsList 到控制台
          for (const mutation of mutationsList) {
            if (mutation.type === "childList") {
              const addedNodes = Array.from(mutation.addedNodes);
              addedNodes.forEach((node) => {
                if (
                  node.nodeType === Node.ELEMENT_NODE &&
                  node.classList.contains("sc-monitor-value")
                ) {
                  alert("iframe 中的 monitor_value_ZEFKO 存在了！");
                }
              });
            }
          }
        });

        // 啟動監聽，針對 iframe 的 body
        observer.observe(iframeDocument.body, {
          childList: true,
          subtree: true,
        });
      });
    </script>
  </body>
</html>
